<resource xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
		xmlns:apti="http://midpoint.evolveum.com/xml/ns/public/common/api-types-3"
		xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
		xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-3"
		xmlns:org="http://midpoint.evolveum.com/xml/ns/public/common/org-3"
		xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3"
		xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance-3"
		xmlns:t="http://prism.evolveum.com/xml/ns/public/types-3"
		xmlns:cap="http://midpoint.evolveum.com/xml/ns/public/resource/capabilities-3"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		oid="3aaf7433-9787-4b1d-9ca0-8c75c695ffab">
	<name>GYBONID</name>
	<connectorRef type="ConnectorType">
		<filter>
			<q:equal>
				<q:path>c:connectorType</q:path>
				<q:value>org.identityconnectors.databasetable.DatabaseTableConnector</q:value>
			</q:equal>
		</filter>
	</connectorRef>
	<connectorConfiguration xmlns:icfc="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-3">
		<icfc:configurationProperties xmlns:icfcdb="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/com.evolveum.polygon.connector-databasetable/org.identityconnectors.databasetable.DatabaseTableConnector">
			<icfcdb:host><expression><const>resourceGYBONIDhost</const></expression></icfcdb:host>
			<icfcdb:port><expression><const>resourceGYBONIDport</const></expression></icfcdb:port>
			<icfcdb:user><expression><const>resourceGYBONIDuser</const></expression></icfcdb:user>
			<icfcdb:password><expression><const>resourceGYBONIDpassword</const></expression></icfcdb:password>
			<icfcdb:database><expression><const>resourceGYBONIDdatabase</const></expression></icfcdb:database>
			<icfcdb:table>GYBONID</icfcdb:table>
			<icfcdb:keyColumn>GYBONID_PIDM</icfcdb:keyColumn>
			<icfcdb:changeLogColumn>GYBONID_ACTIVITY_DATE</icfcdb:changeLogColumn>
			<icfcdb:nativeTimestamps>true</icfcdb:nativeTimestamps>
			<icfcdb:allNative>true</icfcdb:allNative>
			<icfcdb:jdbcDriver>oracle.jdbc.driver.OracleDriver</icfcdb:jdbcDriver>
			<icfcdb:jdbcUrlTemplate><expression><const>resourceGYBONIDjdbcurltemplate</const></expression></icfcdb:jdbcUrlTemplate>
		</icfc:configurationProperties>
	</connectorConfiguration>

	<!-- This is an inbound resource, so we normally won't have assignments for it -->
	<projection>
		<assignmentPolicyEnforcement>none</assignmentPolicyEnforcement>
	</projection>

	<schemaHandling>
		<objectType>
			<kind>account</kind>
			<default>true</default>
			<objectClass>ri:AccountObjectClass</objectClass>
			<attribute>
				<ref>icfs:uid</ref>
				<displayName>icfs:uid(GYBONID_PIDM)</displayName>
				<limitations>
					<access>
						<read>true</read>
					</access>
				</limitations>
			</attribute>
			<attribute>
				<ref>icfs:name</ref>
				<displayName>icfs:name(GYBONID_PIDM)</displayName>
				<limitations>
					<access>
						<read>true</read>
					</access>
				</limitations>
				<inbound>
					<target>
						<path>$user/extension/idBannerPIDM</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_OSUUID</ref>
				<inbound>
					<expression><script><code>basic.stringify(input)</code></script></expression>
					<target>
						<path>$user/name</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_LOGIN_NAME</ref>
				<inbound>
					<target>
						<path>$user/extension/username</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_OSU_ID</ref>
				<limitations>
					<access>
						<read>true</read>
					</access>
				</limitations>
				<inbound>
					<target>
						<path>$user/extension/idBannerOSUID</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_UDC_ID</ref>
				<limitations>
					<access>
						<read>true</read>
					</access>
				</limitations>
				<inbound>
					<target>
						<path>$user/extension/idBannerUDCID</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_FIRST_NAME</ref>
				<inbound>
					<target>
						<path>$user/givenName</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_MI_NAME</ref>
				<inbound>
					<target>
						<path>$user/additionalName</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_LAST_NAME</ref>
				<inbound>
					<target>
						<path>$user/familyName</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_BIRTH_DATE</ref>
				<limitations>
					<access>
						<read>true</read>
					</access>
				</limitations>
				<inbound>
					<expression>
						<script>
							<code>
								tmpdate = basic.stringify(input).split(" ")[0];
								basic.parseDateTime("yyyy-MM-dd", tmpdate);
							</code>
						</script>
					</expression>
					<condition>
						<script>
							<code>!basic.isEmpty(input)</code>
						</script>
					</condition>
					<target>
						<path>$user/extension/birthdate</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_PRIMARY_AFFILIATION</ref>
					<limitations>
						<access>
							<read>true</read>
						</access>
					</limitations>
				<inbound>
					<target>
						<path>$user/extension/osuPrimaryAffiliation</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_UID</ref>
				<inbound>
					<expression><script><code>basic.stringify(input)</code></script></expression>
					<target>
						<path>$user/extension/posixUidNumber</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_GID</ref>
				<inbound>
					<expression><script><code>basic.stringify(input)</code></script></expression>
					<target>
						<path>$user/extension/posixGidNumber</path>
					</target>
				</inbound>
			</attribute>
			<attribute>
				<ref>ri:GYBONID_HOME_DIR</ref>
				<inbound>
					<target>
						<path>$user/extension/posixHomeDir</path>
					</target>
				</inbound>
			</attribute>
		</objectType>
	</schemaHandling>

	<capabilities>
		<configured>
			<cap:create>
				<cap:enabled>false</cap:enabled>
			</cap:create>
			<cap:update>
				<cap:enabled>false</cap:enabled>
			</cap:update>
			<cap:delete>
				<cap:enabled>false</cap:enabled>
			</cap:delete>
		</configured>
	</capabilities>

	<synchronization>
		<objectSynchronization>
			<name>Account sync policy</name>
			<objectClass>ri:AccountObjectClass</objectClass>
			<kind>account</kind>
			<intent>default</intent>
			<focusType>c:UserType</focusType>
			<enabled>true</enabled>

			<condition>
				<script>
					<code>
						!basic.isEmpty(basic.getAttributeValue(shadow, "GYBONID_OSUUID"))
					</code>
				</script>
			</condition>

			<correlation>
				<q:equal>
					<q:path>extension/idBannerPIDM</q:path>
					<expression>
						<path>
							$shadow/attributes/icfs:name
						</path>
					</expression>
				</q:equal>
			</correlation>
			<!-- No confirmation expression -->

			<reaction>
				<situation>linked</situation>
				<synchronize>true</synchronize>
			</reaction>
			<reaction>
				<situation>deleted</situation>
				<synchronize>true</synchronize>
				<action>
					<handlerUri>http://midpoint.evolveum.com/xml/ns/public/model/action-3#unlink</handlerUri>
				</action>
			</reaction>
			<reaction>
				<situation>unlinked</situation>
				<synchronize>true</synchronize>
				<action>
					<handlerUri>http://midpoint.evolveum.com/xml/ns/public/model/action-3#link</handlerUri>
				</action>
			</reaction>
			<reaction>
				<situation>unmatched</situation>
				<synchronize>true</synchronize>
				<action>
					<handlerUri>http://midpoint.evolveum.com/xml/ns/public/model/action-3#addFocus</handlerUri>
				</action>
			</reaction>
		</objectSynchronization>
	</synchronization>

</resource>
